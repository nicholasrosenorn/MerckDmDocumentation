[
["tutorial-data-capture-in-python.html", "Chapter 8 Tutorial - Data Capture in Python 8.1 Getting Started 8.2 Imports 8.3 Authentication 8.4 Accessing Data 8.5 Processing Data 8.6 Storing Data", " Chapter 8 Tutorial - Data Capture in Python 8.1 Getting Started Before starting this section of the tutorial, we need to download the Fitbit API. Navigate to https://github.com/orcasgit/python-fitbit and click the green ‘clone or download’ button. Then, click download zip, and open the zip file in the same folder that you are using within Anaconda. Next, download python on to your computer at https://www.python.org/downloads/. Click on the yellow ‘download’ button, open the downloaded file, and follow the steps to install. Lastly, open a new terminal, and run the following commands: pip install cherrypy (you can also use the Anaconda navigator to install cherrypy) pip install requests-oauthlib 8.2 Imports This project requires multiple packages. If the steps in the previous sections have been followed, these import statements should run seamlessly. #Import the necessary packages import fitbit import gather_keys_oauth2 as Oauth2 import pandas as pd import datetime import json 8.3 Authentication Remembering back to the Fibit Technology section, we registered an app on the Fitbit Development site that will allow us to access our account data. When we completed the registration of the app, we were given a client id and client secret. These codes are unique to each individual app that is registered and are neccessary for the authentication process. Use the following code gain access to your account: CLIENT_ID = &#39;22BLXS&#39; #ENTER CLIENT ID CODE HERE CLIENT_SECRET = &#39;a259368e5736a4171753dba8133f06d4&#39; #ENTER CLIENT SECRET CODE HERE server = Oauth2.OAuth2Server(CLIENT_ID, CLIENT_SECRET) server.browser_authorize() ACCESS_TOKEN = str(server.fitbit.client.session.token[&#39;access_token&#39;]) REFRESH_TOKEN = str(server.fitbit.client.session.token[&#39;refresh_token&#39;]) auth2_client = fitbit.Fitbit(CLIENT_ID, CLIENT_SECRET, oauth2=True, access_token=ACCESS_TOKEN, refresh_token=REFRESH_TOKEN) When the code above is run for the first time, you will be directed to a new browser with the following screen: Select ‘Allow All’ and then ‘Allow’. Your browser will then display the follow: When you have reached this screen, the authentication is complete and you can now access your account data. According the fitbit documentation, you can access your data, by default, for 8 hours until you will have to reautheticate by running the authorization code above. 8.4 Accessing Data Now that the authentication is complete, we can access our data. To start, we need to delcare a date to collect data from. Let’s use today’s date: today = str(datetime.datetime.now().strftime(&quot;%Y-%m-%d&quot;)) #todays date Now we can view our ‘activities’ data for todays date. activities = auth2_client.activities(date = today) Notice how the data is formatted in nested dictionary format, similar to json file format. Becuase of this format, we need to decompose the nested dictionaries to access our desired data. For example, if we want to access the total distance traveled we can do the following: activities = auth2_client.activities(date = today)[&#39;summary&#39;] totalDistance = activities[&#39;distances&#39;][0][&#39;distance&#39;] To access today’s steps: steps = activities[&#39;steps&#39;] The process is almost identical for accessing other types of data (i.e. sleep, heart, and weight data). 8.5 Processing Data Because we are now familiar with the structure of of data, we can begin processing it! To collect activities data: #gets all Activities Data def getActivities(myDate): activities = auth2_client.activities(date = myDate)[&#39;summary&#39;] totalDistance = activities[&#39;distances&#39;][0][&#39;distance&#39;] veryActiveDistance = activities[&#39;distances&#39;][3][&#39;distance&#39;] moderatleyActiveDistance = activities[&#39;distances&#39;][4][&#39;distance&#39;] lightlyActiveDistance = activities[&#39;distances&#39;][5][&#39;distance&#39;] veryActiveMinutes = activities[&#39;veryActiveMinutes&#39;] fairlyActiveMinutes = activities[&#39;fairlyActiveMinutes&#39;] lightlyActiveMinutes = activities[&#39;lightlyActiveMinutes&#39;] sedentaryMinutes = activities[&#39;sedentaryMinutes&#39;] floorsClimbed = activities[&#39;floors&#39;] daySteps =activities[&#39;steps&#39;] return totalDistance, veryActiveDistance, moderatleyActiveDistance, lightlyActiveDistance, veryActiveMinutes, fairlyActiveMinutes, lightlyActiveMinutes, sedentaryMinutes, floorsClimbed, daySteps To collect sleep data: #gets all Sleep data def getSleep(myDate): nightSleep = auth2_client.sleep(date = myDate)[&#39;sleep&#39;] sleepEfficiency = None minutesAsleep = None if len(nightSleep) != 0: sleepEfficiency = nightSleep[0][&#39;efficiency&#39;] minutesAsleep = nightSleep[0][&#39;minutesAsleep&#39;] return sleepEfficiency, minutesAsleep To collect heart data: #gets all Heart Data def getHeart(myDate): heartRates = auth2_client.intraday_time_series(&#39;activities/heart&#39;, base_date=myDate, detail_level=&#39;1sec&#39;)[&#39;activities-heart&#39;][0][&#39;value&#39;] HRrange30to100 = None HRrange100to140 = None HRrange140to170 = None HRrange170to220 = None avgRestingHR = None if len(heartRates) == 3: HRrange30to100 = heartRates[&#39;heartRateZones&#39;][0][&#39;minutes&#39;] HRrange100to140 = heartRates[&#39;heartRateZones&#39;][1][&#39;minutes&#39;] HRrange140to170 = heartRates[&#39;heartRateZones&#39;][2][&#39;minutes&#39;] HRrange170to220 = heartRates[&#39;heartRateZones&#39;][3][&#39;minutes&#39;] avgRestingHR = heartRates[&#39;restingHeartRate&#39;] return HRrange30to100, HRrange100to140, HRrange140to170, HRrange170to220, avgRestingHR To collect weight data: #gets all Weight Data def getWeight(myDate): grabWeight = auth2_client.get_bodyweight(base_date = myDate)[&#39;weight&#39;] weight = None BMI = None if len(grabWeight) &gt; 0: weight = grabWeight[0][&#39;weight&#39;] BMI = grabWeight[0][&#39;bmi&#39;] return weight, BMI Now that we have the functions to capture the data, we can process our data with a pandas data frame: #creates empty data frame biometricDF = pd.DataFrame(columns=[&quot;Date&quot;, &quot;Steps&quot;, &quot;Floors Climbed&quot;, &quot;Total Miles&quot;, &quot;Lightly Active Miles&quot;, &quot;Moderately Active Miles&quot;, &quot;Very Active Miles&quot;, &quot;Sedentary Minutes&quot;, &quot;Lightly Active Minutes&quot;, &quot;Fairly Active Minutes&quot;, &quot;Very Active Minutes&quot;, &quot;HR 30-100 Minutes&quot;, &quot;HR 100-140 Minutes&quot;, &quot;HR 140-170 Minutes&quot;, &quot;HR 170-220 Minutes&quot;, &quot;Average Resting HR&quot;]) Next, we will need a function to collect all the data togother and place it into a data frame: #adds data to data frame def getBiometricData(myDF, myDate): totalDistance, veryActiveDistance, moderatleyActiveDistance, lightlyActiveDistance, veryActiveMinutes, fairlyActiveMinutes, lightlyActiveMinutes, sedentaryMinutes, floorsClimbed, daySteps = getActivities(myDate) sleepEfficiency, minutesAsleep = getSleep(myDate) HRrange30to100, HRrange100to140, HRrange140to170, HRrange170to220, avgRestingHR = getHeart(myDate) weight, BMI = getWeight(myDate) todaysData = {&quot;Date&quot; : myDate, &quot;Steps&quot; : daySteps, &quot;Floors Climbed&quot; : floorsClimbed, &quot;Total Miles&quot;: totalDistance, &quot;Lightly Active Miles&quot;: lightlyActiveDistance, &quot;Moderately Active Miles&quot; : moderatleyActiveDistance, &quot;Very Active Miles&quot; : veryActiveDistance, &quot;Sedentary Minutes&quot;: sedentaryMinutes, &quot;Lightly Active Minutes&quot;: lightlyActiveMinutes, &quot;Fairly Active Minutes&quot; : fairlyActiveMinutes, &quot;Very Active Minutes&quot; : veryActiveMinutes,&quot;HR 30-100 Minutes&quot; : HRrange30to100, &quot;HR 100-140 Minutes&quot;: HRrange100to140, &quot;HR 140-170 Minutes&quot; : HRrange140to170, &quot;HR 170-220 Minutes&quot; : HRrange170to220, &quot;Average Resting HR&quot;: avgRestingHR, &quot;Sleep Efficiency&quot; : sleepEfficiency, &quot;Weight&quot; : weight, &quot;Minutes Alseep&quot; : minutesAsleep, &quot;BMI&quot; : BMI} biometricDF = myDF.append(todaysData, ignore_index=True) return biometricDF And, finally, creating the database with todays data: biometricDF = getBiometricData(biometricDF, today) #append to data frame 8.6 Storing Data This process can be replicated each day so data must be stored appropriately. To start, we can export our data frame to a csv file and save the files to a directory like this (I created a new folder named bioDates to store all my Data): biometricDF.to_csv(&#39;./bioDates/&#39; + today + &#39;.csv&#39;) In the following chapters of this tutorial, we will learn how to concatenate the indiviudal daily csv files into one master file as well as storing the data into a a SQL database! "]
]
